<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë§ˆì´í˜ì´ì§€ | ë² ë²  ì ‘ì¢… ìˆ˜ì²©</title>

<link rel="stylesheet" href="/css/fragments/layout.css" />
<link rel="stylesheet" href="/css/login/insertModal.css" />
<link rel="stylesheet" href="/css/myPage/info.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


</head>

<body>

<!-- header -->
<div th:replace="~{fragments/header::header}"></div>
   <!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->
<div th:replace="~{fragments/insertModal::insertModal}"></div>
	
<!--	ë¡œê·¸ì¸ ëª¨ë‹¬-->
<div th:replace="~{fragments/loginModal::loginModal}"></div> 
<!-- content -->
<div class="mypage-wrapper">

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="mypage-sidebar">
        <h3>ìë…€ ì •ë³´</h3>
        <ul class="sidebar-menu">
            <li><a href="/myPage/info" class="active">ìë…€ ì •ë³´</a></li>
            <li><a href="/myPage/myHospital">ë‚˜ì˜ ë³‘ì›</a></li>
            <li><a href="/myPage/payHistory">ê²°ì œ ë‚´ì—­</a></li>
            <li><a href="/myPage/payControl">ê²°ì œ ê´€ë¦¬</a></li>
        </ul>
    </aside>

    <!-- ì½˜í…ì¸  -->
    <section class="mypage-content">

        <!-- ìë…€ ì •ë³´ ì¹´ë“œ -->
        <div class="mypage-card child-card" id="childCard">
            <div class="child-avatar">
                <i class="fa-solid fa-child-reaching"></i>
            </div>

            <!-- ë³´ê¸° ëª¨ë“œ -->
            <div class="child-info" id="viewMode">
                <h4 id="childName">í† ë¼</h4>
                <p>
                    <span id="childBirthday">2024.01.01</span> (<span id="childGender">ì—¬</span>)<br>
                    íƒœì–´ë‚œì§€ <span id="childDays">722</span>ì¼ì§¸ì˜ˆìš”
                </p>
            </div>

            <!-- í¸ì§‘ ëª¨ë“œ -->
            <div class="child-info-edit" id="editMode" style="display: none;">
                <div class="edit-field">
                    <label>ì´ë¦„</label>
                    <input type="text" id="editName" value="í† ë¼">
                </div>
                <div class="edit-field">
                    <label>ìƒë…„ì›”ì¼</label>
                    <input type="date" id="editBirthday" value="2024-01-01">
                </div>
                <div class="edit-field">
                    <label>ì„±ë³„</label>
                    <div class="gender-select">
                        <label class="gender-option">
                            <input type="radio" name="gender" value="ë‚¨" id="genderMale">
                            <span>ë‚¨</span>
                        </label>
                        <label class="gender-option">
                            <input type="radio" name="gender" value="ì—¬" id="genderFemale" checked>
                            <span>ì—¬</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- ë²„íŠ¼ -->
            <button class="child-edit-btn" id="editBtn" onclick="toggleEditMode()">ìˆ˜ì •</button>
            <div class="edit-buttons" id="editButtons" style="display: none;">
                <button class="btn-cancel" onclick="cancelEdit()">ì·¨ì†Œ</button>
                <button class="btn-save" onclick="saveEdit()">ì €ì¥</button>
            </div>
        </div>

        <!-- ì ‘ì¢… ìˆ˜ì²© -->
        <div class="mypage-card">
            <h4>ì ‘ì¢… ìˆ˜ì²©</h4>

            <table class="vaccine-table">
                <thead>
                    <tr>
                        <th>ëŒ€ìƒì „ì—¼ë³‘</th>
                        <th>1ì°¨</th>
                        <th>2ì°¨</th>
                        <th>3ì°¨</th>
                        <th>ì¶”ê°€1ì°¨</th>
                        <th>ì¶”ê°€2ì°¨</th>
                        <th>ì¶”ê°€3ì°¨</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>BCG</td>
                        <td></td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td>
                    </tr>

                    <tr>
                        <td>Bí˜•ê°„ì—¼</td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td>DPT</td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td>ì†Œì•„ë§ˆë¹„</td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td>ë‡Œìˆ˜ë§‰ì—¼</td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td>íêµ¬ê· </td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td>MMR</td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td>ìˆ˜ë‘</td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td>ì¼ë³¸ë‡Œì—¼</td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td>Aí˜• ê°„ì—¼</td>
                        <td class="vaccine-empty" onclick="openVaccineInput(this)">
                            <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
                            <div class="vaccine-input-box">
                                <input type="text" placeholder="ì ‘ì¢…í•œ ë³‘ì›">
                                <input type="date">
                                <input type="text" placeholder="ë°±ì‹  ì´ë¦„">
                            </div>
                        </td>
                        <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                </tbody>
            </table>
        </div>

    </section>
</div>

<!-- footer -->
<div th:replace="~{fragments/footer::footer}"></div>
<!-- ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸ -->
<div th:replace="~{fragments/header::modalScript}"></div>

<script>

	let activeVaccineTd = null; // ğŸ”¥ í˜„ì¬ ì—´ë ¤ìˆëŠ” ì ‘ì¢… ì¹¸

	// ë°±ì‹  ì…ë ¥
	function openVaccineInput(td) {
	    // ì´ë¯¸ ë‹¤ë¥¸ ì¹¸ì´ ì—´ë ¤ ìˆìœ¼ë©´ ë¬´ì‹œ
	    if (activeVaccineTd && activeVaccineTd !== td) {
	        return;
	    }

	    // ì´ë¯¸ í™œì„±í™”ëœ ê²½ìš°ë„ ë¬´ì‹œ
	    if (td.classList.contains('active')) return;

	    activeVaccineTd = td;
	    td.classList.add('active');

	    const inputBox = td.querySelector('.vaccine-input-box');

	    if (!inputBox.querySelector('.vaccine-save-btn')) {
	        const saveBtn = document.createElement('button');
	        saveBtn.className = 'vaccine-save-btn';
	        saveBtn.textContent = 'ì €ì¥';
	        saveBtn.onclick = function(e) {
	            e.stopPropagation();
	            saveVaccineData(td);
	        };
	        inputBox.appendChild(saveBtn);
	    }
	}

	// ë°±ì‹  ë°ì´í„° ì €ì¥
	function saveVaccineData(td) {
	    const inputBox = td.querySelector('.vaccine-input-box');
	    const hospital = inputBox.querySelector('input[type="text"]:nth-child(1)').value.trim();
	    const date = inputBox.querySelector('input[type="date"]').value;
	    const vaccine = inputBox.querySelector('input[type="text"]:nth-child(3)').value.trim();

	    if (!hospital || !date || !vaccine) return;

	    td.classList.remove('active');
	    td.classList.add('saved');
	    td.innerHTML = `
	        <div class="vaccine-saved-data">
	            <div class="saved-hospital">${hospital}</div>
	            <div class="saved-date">${date}</div>
	            <div class="saved-vaccine">${vaccine}</div>
	        </div>
	        <button class="vaccine-edit-btn" onclick="editVaccineData(this)">
	            <i class="fa-solid fa-pen"></i>
	        </button>
	    `;

	    activeVaccineTd = null; // ğŸ”¥ ì…ë ¥ ì¢…ë£Œ
	}

	// ë°±ì‹  ë°ì´í„° ìˆ˜ì •
	function editVaccineData(button) {
	    const td = button.closest('td');

	    // ë‹¤ë¥¸ ì¹¸ ìˆ˜ì • ì¤‘ì´ë©´ ë¬´ì‹œ
	    if (activeVaccineTd && activeVaccineTd !== td) {
	        return;
	    }

	    activeVaccineTd = td;

	    const savedData = td.querySelector('.vaccine-saved-data');
	    const hospital = savedData.querySelector('.saved-hospital').textContent;
	    const date = savedData.querySelector('.saved-date').textContent;
	    const vaccine = savedData.querySelector('.saved-vaccine').textContent;

	    td.classList.remove('saved');
	    td.classList.add('active');
	    td.innerHTML = `
	        <span class="vaccine-placeholder">í´ë¦­í•´ì„œ ì…ë ¥</span>
	        <div class="vaccine-input-box" style="display: block;">
	            <input type="text" value="${hospital}">
	            <input type="date" value="${date}">
	            <input type="text" value="${vaccine}">
	            <button class="vaccine-save-btn" onclick="saveVaccineData(this.closest('td'))">ì €ì¥</button>
	        </div>
	    `;
	}

// ì›ë³¸ ë°ì´í„° ì €ì¥
let originalData = {
    name: 'í† ë¼',
    birthday: '2024-01-01',
    gender: 'ì—¬'
};

// í¸ì§‘ ëª¨ë“œ í† ê¸€
function toggleEditMode() {
    const viewMode = document.getElementById('viewMode');
    const editMode = document.getElementById('editMode');
    const editBtn = document.getElementById('editBtn');
    const editButtons = document.getElementById('editButtons');
    const childCard = document.getElementById('childCard');

    viewMode.style.display = 'none';
    editMode.style.display = 'block';
    editBtn.style.display = 'none';
    editButtons.style.display = 'flex';
    childCard.classList.add('editing');
}

// ì·¨ì†Œ
function cancelEdit() {
    const viewMode = document.getElementById('viewMode');
    const editMode = document.getElementById('editMode');
    const editBtn = document.getElementById('editBtn');
    const editButtons = document.getElementById('editButtons');
    const childCard = document.getElementById('childCard');

    // ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›
    document.getElementById('editName').value = originalData.name;
    document.getElementById('editBirthday').value = originalData.birthday;
    if (originalData.gender === 'ë‚¨') {
        document.getElementById('genderMale').checked = true;
    } else {
        document.getElementById('genderFemale').checked = true;
    }

    viewMode.style.display = 'block';
    editMode.style.display = 'none';
    editBtn.style.display = 'block';
    editButtons.style.display = 'none';
    childCard.classList.remove('editing');
}

// ì €ì¥
function saveEdit() {
    const name = document.getElementById('editName').value.trim();
    const birthday = document.getElementById('editBirthday').value;
    const gender = document.querySelector('input[name="gender"]:checked').value;

    // ìœ íš¨ì„± ê²€ì‚¬
    if (!name) {
        alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    if (!birthday) {
        alert('ìƒë…„ì›”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }

    // ë°ì´í„° ì—…ë°ì´íŠ¸
    originalData = { name, birthday, gender };
    
    // í™”ë©´ ì—…ë°ì´íŠ¸
    document.getElementById('childName').textContent = name;
    document.getElementById('childBirthday').textContent = birthday.replace(/-/g, '.');
    document.getElementById('childGender').textContent = gender;

    // ì¼ìˆ˜ ê³„ì‚°
    const birthDate = new Date(birthday);
    const today = new Date();
    const diffTime = Math.abs(today - birthDate);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    document.getElementById('childDays').textContent = diffDays;

    // í¸ì§‘ ëª¨ë“œ ì¢…ë£Œ
    const viewMode = document.getElementById('viewMode');
    const editMode = document.getElementById('editMode');
    const editBtn = document.getElementById('editBtn');
    const editButtons = document.getElementById('editButtons');
    const childCard = document.getElementById('childCard');

    viewMode.style.display = 'block';
    editMode.style.display = 'none';
    editBtn.style.display = 'block';
    editButtons.style.display = 'none';
    childCard.classList.remove('editing');

    // TODO: ì„œë²„ì— ë°ì´í„° ì „ì†¡
    console.log('ì €ì¥ëœ ë°ì´í„°:', originalData);
    alert('ìë…€ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
}
</script>

</body>
</html>