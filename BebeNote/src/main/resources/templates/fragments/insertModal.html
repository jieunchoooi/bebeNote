<!-- signup-modal.html -->
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
</head>

<body>
    <!-- 회원가입 모달 -->
	
    <div id="insertModal" class="signup-modal-overlay" th:fragment="insertModal">
        <div class="signup-modal-container">
            <div class="signup-modal-header">
                <h2 class="signup-modal-title">회원가입</h2>
                <button type="button" class="signup-modal-close" onclick="closeInsertModal()">×</button>
            </div>
            
            <div class="signup-modal-body">
                <form id="signupForm" th:action="@{/member/insertPro}" method="post">
                    <div class="signup-form-group">
                        <label class="signup-form-label" for="userId">아이디<span class="signup-required">*</span></label>
                        <div class="signup-input-with-button">
                            <input type="text" class="signup-form-input" id="userId" name="user_id" placeholder="아이디를 입력하세요" required>
                            <button type="button" class="signup-btn-check">중복확인</button>
                        </div>
						<span class="user_id_check check"></span>
                    </div>
                    
                    <div class="signup-form-group">
                        <label class="signup-form-label" for="password">비밀번호<span class="signup-required">*</span></label>
                        <input type="password" class="signup-form-input" id="password" name="password"
                               placeholder="비밀번호를 입력하세요" >
						<span class="user_password_check check"></span>
                    </div>
                    
                    <div class="signup-form-group">
                        <label class="signup-form-label" for="password1">비밀번호 확인<span class="signup-required">*</span></label>
                        <input type="password" class="signup-form-input" id="password1" name="password1"
                               placeholder="비밀번호를 한번 더 입력하세요" required>
						<span class="user_password1_check check"></span>
                    </div>
                    
                    <div class="signup-form-group">
                        <label class="signup-form-label" for="name">이름<span class="signup-required">*</span></label>
                        <input type="text" class="signup-form-input" id="name" name="name"
                               placeholder="이름을 입력하세요" required>
                    </div>

                    <div class="signup-form-group">
                        <label class="signup-form-label" for="phone">전화번호<span class="signup-required">*</span></label>
                        <input type="tel" class="signup-form-input" id="phone" name="phone"
                               placeholder="숫자만 입력해 주세요" required>
						<span class="user_phone_check check"></span>
                    </div>

					<div class="signup-form-group">
					    <label class="signup-form-label" for="address">주소<span class="signup-required">*</span></label>
					    <div class="address-postcode-group">
					        <input type="text" id="sample6_postcode" class="signup-form-input" placeholder="우편번호" readonly>
					        <input type="button" class="signup-btn-postcode" onclick="sample6_execDaumPostcode()" value="우편번호 찾기">
					    </div>
						<input type="text" class="signup-form-input" id="sample6_address" name="address" placeholder="주소" style="margin-bottom: 5px;" styrequired readonly>
						<input type="text" class="signup-form-input" id="sample6_detailAddress" name="detailAddress" placeholder="상세주소">
					</div>

                    <div class="signup-form-group">
                        <label class="signup-form-label" for="email">이메일<span class="signup-required">*</span></label>
                        <input type="email" class="signup-form-input" id="email" name="email"
                               placeholder="example@email.com" required>
						<span class="user_email_check check"></span>
                    </div>

                    <!-- 약관 동의 섹션 -->
                    <div class="terms-section">
                        <div class="terms-title">약관 동의</div>

                            <div class="signup-checkbox-group">
                                <input type="checkbox" id="agreeAll" class="signup-checkbox-input">
                                <label for="agreeAll" class="signup-checkbox-label">
                                    전체 동의하기
                                </label>
                            </div>

                        <div class="terms-item">
                            <div class="signup-checkbox-group">
                                <input type="checkbox" id="terms" name="terms" class="signup-checkbox-input" required>
                                <label for="terms" class="signup-checkbox-label">
                                    서비스 이용약관 동의<span class="required-tag">필수</span>
                                    <a class="terms-link" href="#" data-toggle="termsContent">
                                        <i class="fas fa-chevron-down"></i> 보기
                                    </a>
                                </label>
                            </div>
                            <div class="terms-content-box" id="termsContent">
                                <h4>제1조 (목적)</h4>
                                <p>본 약관은 회사가 제공하는 서비스의 이용과 관련하여 회사와 회원 간의 권리, 의무 및 책임사항을 규정함을 목적으로 합니다.</p>
                                
                                <h4>제2조 (정의)</h4>
                                <p>1. "서비스"란 회사가 제공하는 모든 온라인 서비스를 의미합니다.</p>
                                <p>2. "회원"이란 회사와 서비스 이용계약을 체결하고 서비스를 이용하는 자를 말합니다.</p>
                                
                                <h4>제3조 (약관의 효력 및 변경)</h4>
                                <p>본 약관은 회원가입 시 동의함으로써 효력이 발생합니다. 회사는 필요한 경우 약관을 변경할 수 있으며, 변경된 약관은 공지 후 7일이 경과한 시점부터 효력이 발생합니다.</p>
                                
                                <h4>제4조 (회원가입)</h4>
                                <p>서비스를 이용하고자 하는 자는 회사가 정한 절차에 따라 회원가입을 신청하고, 회사의 승낙을 받아야 합니다.</p>
                                
                                <h4>제5조 (개인정보의 보호)</h4>
                                <p>회사는 관련 법령이 정하는 바에 따라 회원의 개인정보를 보호하기 위해 노력합니다. 자세한 사항은 개인정보처리방침을 참조하시기 바랍니다.</p>
                                
                                <h4>제6조 (회원의 의무)</h4>
                                <p>회원은 서비스 이용 시 다음 각 호의 행위를 하여서는 안 됩니다.</p>
                                <p>1. 타인의 정보 도용</p>
                                <p>2. 회사가 게시한 정보의 변경</p>
                                <p>3. 회사가 정한 정보 이외의 정보 등의 송신 또는 게시</p>
                                <p>4. 회사 및 기타 제3자의 저작권 등 지적재산권에 대한 침해</p>
                            </div>
                        </div>

                        <div class="terms-item">
                            <div class="signup-checkbox-group">
                                <input type="checkbox" id="privacy" name="privacy" class="signup-checkbox-input" required>
                                <label for="privacy" class="signup-checkbox-label">
                                    개인정보 수집 및 이용 동의<span class="required-tag">필수</span>
                                    <a class="terms-link" href="#" data-toggle="privacyContent">
                                        <i class="fas fa-chevron-down"></i> 보기
                                    </a>
                                </label>
                            </div>
                            <div class="terms-content-box" id="privacyContent">
                                <h4>1. 개인정보의 수집 항목</h4>
                                <p>회사는 회원가입, 서비스 제공을 위해 다음과 같은 개인정보를 수집합니다.</p>
                                <p><strong>필수항목:</strong> 아이디, 비밀번호, 이름, 전화번호, 주소, 이메일</p>
                                <p><strong>선택항목:</strong> 상세주소</p>
                                
                                <h4>2. 개인정보의 수집 및 이용 목적</h4>
                                <p><strong>회원 관리:</strong> 회원제 서비스 이용에 따른 본인확인, 개인식별, 불량회원의 부정 이용 방지와 비인가 사용 방지, 가입 의사 확인</p>
                                <p><strong>서비스 제공:</strong> 계약 이행, 서비스 제공에 따른 요금정산, 콘텐츠 제공, 맞춤 서비스 제공</p>
                                <p><strong>고객 지원:</strong> 고객 문의 처리, 공지사항 전달</p>
                                
                                <h4>3. 개인정보의 보유 및 이용기간</h4>
                                <p>회원탈퇴 시까지 보유하며, 다만 관계 법령에 따라 일정 기간 보관이 필요한 경우 해당 기간 동안 보관합니다.</p>
                                <p>- 계약 또는 청약철회 등에 관한 기록: 5년 (전자상거래법)</p>
                                <p>- 대금결제 및 재화 등의 공급에 관한 기록: 5년 (전자상거래법)</p>
                                <p>- 소비자 불만 또는 분쟁처리에 관한 기록: 3년 (전자상거래법)</p>
                                
                                <h4>4. 개인정보 제공 거부 권리</h4>
                                <p>귀하는 개인정보 제공 동의를 거부할 권리가 있습니다. 다만, 필수 항목 동의를 거부하실 경우 회원가입 및 서비스 이용이 제한될 수 있습니다.</p>
                            </div>
                        </div>
                    </div>

                    <div class="signup-button-group">
                        <button type="button" class="signup-btn signup-btn-secondary" onclick="closeInsertModal()">
                             취소
                        </button>
                        <button type="submit" class="signup-btn signup-btn-primary">
                             회원가입
                        </button>
                    </div>

					<div class="signup-helper-buttons">
					    <button type="button" class="signup-helper-button">카카오</button>
					    <button type="button" class="signup-helper-button">네이버</button>
					</div>
                    <div class="signup-helper-links">
                        이미 회원이신가요? <a href="#" onclick="closeInsertModal(); openLoginModal(); return false;" class="signup-helper-link">로그인</a>
                    </div>
					<input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}">
                </form>
            </div>
        </div>
        
		<script th:inline="javascript">
		/*<![CDATA[*/
		(function() {
		    // 약관 내용 토글
		    document.addEventListener('click', function(e) {
		        var target = e.target;
		        if (target.closest && target.closest('.terms-link')) {
		            e.preventDefault();
		            var link = target.closest('.terms-link');
		            var targetId = link.getAttribute('data-toggle');
		            var content = document.getElementById(targetId);
		            
		            if (content) {
		                content.classList.toggle('show');
		            }
		        }
		    });

		    // 전체 동의 체크박스
		    var agreeAll = document.getElementById('agreeAll');
		    var terms = document.getElementById('terms');
		    var privacy = document.getElementById('privacy');

		    if (agreeAll) {
		        agreeAll.addEventListener('change', function() {
		            var checked = this.checked;
		            if (terms) terms.checked = checked;
		            if (privacy) privacy.checked = checked;
		        });
		    }

		    // 개별 체크박스
		    if (terms) {
		        terms.addEventListener('change', updateAgreeAll);
		    }
		    if (privacy) {
		        privacy.addEventListener('change', updateAgreeAll);
		    }

		    function updateAgreeAll() {
		        if (agreeAll && terms && privacy) {
		            agreeAll.checked = terms.checked && privacy.checked;
		        }
		    }
		})();
		/*]]>*/

		// 유효성 검사
		let id = document.querySelector("#userId");
		let password = document.querySelector("#password");
		let password1 = document.querySelector("#password1");
		let name = document.querySelector("#name");
		let phone = document.querySelector("#phone");
		let address = document.querySelector("#sample6_address");
		let email = document.querySelector("#email");
		let user_id_check = document.querySelector(".user_id_check");
		let user_password_check = document.querySelector(".user_password_check");
		let user_password1_check = document.querySelector(".user_password1_check");
		let user_phone_check = document.querySelector(".user_phone_check");
		let user_email_check = document.querySelector(".user_email_check");

		// 아이디 유효성 검사
		function testid(){
		    let idRegEX = /^(?=.*\d)[A-Za-z\d!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]{6,20}$/;
		    return idRegEX.test(id.value);
		}

		// 비밀번호 유효성 검사
		function testpassword(){
		    let passwordRegEX = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]).{8,16}$/;
		    return passwordRegEX.test(password.value);
		}

		// 이메일 유효성 검사
		function testemail(){
		    let emailRegEX = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.com$/;
		    return emailRegEX.test(email.value);
		}

		// 전화번호 유효성 검사
		function testphone(){
		    let phoneRegEX = /^\d{11}$/;
		    return phoneRegEX.test(phone.value);
		}

		password.onkeyup = function(){
		    if(!testpassword()){
		        user_password_check.innerHTML = "글자수 : 8 ~ 16, 대소문자, 숫자, 특수문자(!@#$%^&*)를 포함해야 합니다.";
		        user_password_check.style.color = "red";
		    }else{
		        user_password_check.innerHTML = "";
		    }
		}

		password1.onkeyup = function(){
		    if(password.value == password1.value){
		        user_password1_check.innerHTML = "비밀번호가 일치합니다.";
		        user_password1_check.style.color = "green";
		    }else{
		        user_password1_check.innerHTML = "비밀번호가 일치하지 않습니다.";
		        user_password1_check.style.color = "red";
		    }
		}

		phone.onkeyup = function(){
		    if(!testphone()){
		        user_phone_check.innerHTML = "'-' 빼고 11자리 입력해 주세요.";
		        user_phone_check.style.color = "red";
		    }else{
		        user_phone_check.innerHTML = "";
		    }
		}

		email.onkeyup = function(){
		    if(!testemail()){
		        user_email_check.innerHTML = "이메일 형식을 지켜주세요. (example@email.com) ";
		        user_email_check.style.color = "red";
		    }else{
		        user_email_check.innerHTML = "";
		    }
		}

		// 아이디 중복확인
		let isIdChecked = false;   
		let isIdAvailable = false;

		let btn = document.querySelector(".signup-btn-check");

		btn.addEventListener("click", function () {
		    let userId = id.value.trim();

		    if (!userId) {
		        alert("아이디를 입력해 주세요.");
		        id.focus();
		        return;
		    }

		    // 유효성 검사 먼저 확인
		    if(!testid()){
		        alert("아이디 형식을 확인해 주세요.\n글자수: 6~20자, 숫자를 포함해야 합니다.");
		        id.focus();
		        return;
		    }

		    fetch(`/member/checkId?userId=${userId}`)
		        .then(res => res.json())
		        .then(isDuplicate => {
		            isIdChecked = true;

		            if (isDuplicate) {
		                isIdAvailable = false;
		                user_id_check.innerHTML = "이미 사용중인 아이디입니다.";
		                user_id_check.style.color = "red";
		                id.focus();
		            } else {
		                isIdAvailable = true;
		                user_id_check.innerHTML = "사용 가능한 아이디입니다.";
		                user_id_check.style.color = "green";
		            }
		        })
		        .catch(() => {
		            isIdChecked = false;
		            isIdAvailable = false;
		            alert("서버 오류가 발생했습니다.");
		        });
		});

		// 아이디 입력 시 중복 확인을 다시 요청해야 함
		id.addEventListener("input", function () {
		    isIdChecked = false;
		    isIdAvailable = false;
		    
		    if(!testid()){
		        user_id_check.innerHTML = "글자수 : 6 ~ 20, 숫자를 포함해야 합니다.";
		        user_id_check.style.color = "red";
		    } else {
		        user_id_check.innerHTML = "아이디 중복확인을 해주세요.";
		        user_id_check.style.color = "orange";
		    }
		});

		// 폼 제출전 확인
		let form = document.querySelector("#signupForm");

		form.addEventListener("submit", function(e){
		    e.preventDefault();

			// 약관 동의 확인 
			let terms = document.getElementById('terms');
			let privacy = document.getElementById('privacy');

			if(!terms.checked || !privacy.checked){
			    alert("필수 약관에 모두 동의해주세요.");
			    return;
			}
			
		    // 중복확인
		    if (!isIdChecked) {
		        alert("아이디 중복확인을 해주세요.");
		        id.focus();
		        return;
		    }

		    // 아이디
		    if(!testid()){
		        alert("아이디 형식을 확인해 주세요.");
		        id.focus();
		        return;
		    }

		    // 비밀번호
		    if(!testpassword()){
		        alert("비밀번호는 8~16자, 대소문자/숫자/특수문자를 포함해야 합니다.");
		        password.focus();
		        return;
		    }

		    // 비밀번호 확인
		    if(password.value !== password1.value){
		        alert("비밀번호가 일치하지 않습니다.");
		        password1.focus();
		        return;
		    }

		    // 전화번호
		    if(!testphone()){
		        alert("전화번호는 숫자 11자리여야 합니다.");
		        phone.focus();
		        return;
		    }

		    // 이메일
		    if(!testemail()){
		        alert("이메일 형식이 올바르지 않습니다.");
		        email.focus();
		        return;
		    }

			alert("가입되었습니다!");
		    form.submit();
		});
		</script>

		<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
		<script>
		    function sample6_execDaumPostcode() {
		        new daum.Postcode({
		            oncomplete: function(data) {
		                var addr = '';

		                if (data.userSelectedType === 'R') {
		                    addr = data.roadAddress;
		                } else {
		                    addr = data.jibunAddress;
		                }

		                document.getElementById('sample6_postcode').value = data.zonecode;
		                document.getElementById("sample6_address").value = addr;
		                document.getElementById("sample6_detailAddress").focus();
		            }
		        }).open();
		    }
		</script>
		
		
    </div>


</body>
</html>